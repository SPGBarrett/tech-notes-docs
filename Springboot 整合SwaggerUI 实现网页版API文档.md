# Springboot 整合SwaggerUI 实现网页版API文档

## 1. 单模组/单功能模块整合SwaggerUI

### 1.1 添加依赖

在项目的pom.xml文件的<dependecies/>标签下添加SwaggerUI所需的依赖项，添加内容如下：

```xml
		<!-- SwaggerUI dependencies -->
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-swagger2</artifactId>
            <version>2.7.0</version>
        </dependency>
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-swagger-ui</artifactId>
            <version>2.7.0</version>
        </dependency>
```

### 1.2 配置SwaggerUI

在项目中新建config文件夹，在文件夹中新建名为SwaggerConfig的java类文件（文件夹和文件名可以根据自己的需求来命名），并添加如下代码：

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.ParameterBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.schema.ModelRef;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.service.Parameter;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;
import java.util.ArrayList;
import java.util.List;

/**
 * @program: smartsite-master
 * @description: Configuration of swagger UI
 * @author: Barrett
 * @create: 2020-07-02 10:25
 **/
@Configuration
@EnableSwagger2
public class SwaggerConfig {
    @Bean
    public Docket createRestApi() {
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                .useDefaultResponseMessages(false)
                .globalOperationParameters(globalOperationParameters())// 全局参数
                .select()
                .apis(RequestHandlerSelectors.any())
                .paths(PathSelectors.regex("/.*"))// 监控所有路径
                .build();
    }
    private List<Parameter> globalOperationParameters(){
        ParameterBuilder builder = new ParameterBuilder();
        Parameter parameter = builder.name("token").description("登录接口返回的token")
                .modelRef(new ModelRef("string"))
                .parameterType("header")
                .required(false).build();
        ArrayList<Parameter> parameters = new ArrayList<>();
        parameters.add(parameter);
        return parameters;
    }
    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("测试API文档")
                .description("xxx公司 Copyright 2000-2030 (C) All Rights Reserved.")
                .termsOfServiceUrl("http://www.xxx.cn/")
                .contact(new Contact("xxx",null,"xxx@163.com"))
                .version("1.0")
                .build();
    }
}


```

### 1.3 配置swaggerui.html静态资源路径

完成1.1和1.2的操作之后，理论上就可以通过**http://${项目运行的IP}:${项目运行的端口}/swagger-ui.html**访问到API说明网页，虽然当前还没有使用swagger对具体的API进行配置，所以网页里不会有API的信息。

如果访问网页时，浏览器显示空白页，并且该项目后台报错：

```text
No mapping for GET /swagger-ui.html
```

说明SpringBoot自动配置本身没有把/swagger-ui.html这个路径映射到对应的目录META-INF/resources/下面，可以通过添加一个配置类的方法实现。可以在1.2中新建的config文件夹下，新建WebMvcConfig类，并添加如下代码：

```java
package com.barrett.aialertservice.config;

/**
 * @program: smartsite-master
 * @description: Use this configuration to add static resource generated by swaggerUI to the default springboot resource
 * folder, thus the swaggerUI webpage for apis can be properly visited.
 * @author: Barrett
 * @create: 2020-07-02 10:32
 **/
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;
@Configuration
class WebMvcConfig implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("swagger-ui.html")
                .addResourceLocations("classpath:/META-INF/resources/");

        registry.addResourceHandler("/webjars/**")
                .addResourceLocations("classpath:/META-INF/resources/webjars/");
    }
}

```



### 1.4 使用Swagger配置API说明文档

Spring整合的SwaggerUI通过注解的方式实现API说明文档的配置。以一个controller为例，代码如下：

```java
/**
 * @program: smartsite-master
 * @description: Restful API for AI alert
 * @author: Barrett
 * @create: 2020-05-05 11:12
 **/

@EnableDiscoveryClient
@CrossOrigin
@RestController
@RequestMapping({"/AIAlert"})
@Api(tags = {"登录/注销接口"})
public class AIAlertController {
    // Restful API availability test:
    @ApiOperation(value = "查询用户接口")
    @ApiImplicitParams({ @ApiImplicitParam(name = "address", value = "地址", paramType = "query", required = true),
            @ApiImplicitParam(name = "age", value = "年龄", paramType = "query", required = true)})
    @RequestMapping(value = {"/test"}, method = {RequestMethod.GET})
    public String test() {
        System.out.println("Testing Requesting!");
        return "This is a test from port: " + currentPort;
    }
}
```

下面列举一些常用的SwaggerUI注解：

- **@Api()**用于类； 
表示标识这个类是swagger的资源 
- **@ApiOperation()**用于方法； 
表示一个http请求的操作 
- **@ApiParam()**用于方法，参数，字段说明； 
表示对参数的添加元数据（说明或是否必填等） 
- **@ApiModel()**用于类 
表示对类进行说明，用于参数用实体类接收 
- **@ApiModelProperty()**用于方法，字段 
表示对model属性的说明或者数据操作更改 
- **@ApiIgnore()**用于类，方法，方法参数 
表示这个方法或者类被忽略 
- **@ApiImplicitParam()** 用于方法 
表示单独的请求参数 
- **@ApiImplicitParams()** 用于方法，包含多个 @ApiImplicitParam

具体参数说明： 
**@Api()** 
用于类；表示标识这个类是swagger的资源 
tags–表示说明 
value–也是说明，可以使用tags替代 
但是tags如果有多个值，会生成多个list

**@ApiOperation()** 用于方法；表示一个http请求的操作 
value用于方法描述 
notes用于提示内容 
tags可以重新分组（视情况而用） 
**@ApiParam()** 用于方法，参数，字段说明；表示对参数的添加元数据（说明或是否必填等） 
name–参数名 
value–参数说明 
required–是否必填

**@ApiModel()**用于类 ；表示对类进行说明，用于参数用实体类接收 
value–表示对象名 
description–描述 
都可省略 
**@ApiModelProperty()**用于方法，字段； 表示对model属性的说明或者数据操作更改 
value–字段说明 
name–重写属性名字 
dataType–重写属性类型 
required–是否必填 
example–举例说明 
hidden–隐藏

**@ApiIgnore()**用于类或者方法上，可以不被swagger显示在页面上 
比较简单, 这里不做举例

**@ApiImplicitParam()** 用于方法 
表示单独的请求参数 
**@ApiImplicitParams()** 用于方法，包含多个 @ApiImplicitParam 
name–参数ming 
value–参数说明 
dataType–数据类型 
paramType–参数类型 
example–举例说明

### 1.5 显示效果

<img src="C:\Users\spg_b\AppData\Roaming\Typora\typora-user-images\image-20200702191024135.png" alt="image-20200702191024135" style="zoom:50%;" />

## 2. 多模组项目集成统一的SwaggerUI

当项目中涉及到多个功能模组的时候，使用上一章中的方法就需要每个module都使用一个url，这样显然是不合理的。可以通过SpringCloud的网关组件Zuul来实现一个界面访问所有module的API文档，其基本原理是网关路由，所以实现该方法的前提，是要实现并运行Zuul网关和Eureka注册中心，网关通过app-name在Eureka中查询到对应的url，从而实现路由。如果没有Eureka，也可以直接将url配资到zuul的.properties文件中。方法如下：

```properties
zuul.routes.ai-alert-service.path=/zb-api/ai-alert-service/** 
# If Eureka in not working, the subsequent code should be added so that Zuul can find url by app-name
zuul.routes.ai-alert-service.url=http://127.0.0.1:6002
```

其中ai-alert-service是一个组件的app-name。

### 2.1 单一模块实现SwaggerUI的文档配置

对项目中每个单独的模组实现Swagger的文档配置，方法与第一章的内容相同。配置完成后，依旧可以**http://${项目运行的IP}:${项目运行的端口}/swagger-ui.html**用来测试一下是否能够访问到API文档。

### 2.2 新建并实现Zuul网关组件

请参照Zuul使用相关教程和说明，这里不单独说明。

### 2.3 新建并实现Eureka注册中心组件

请参照Eureka使用相关教程和说明，这里不单独说明。如果决定不使用Eureka，也可以直接将路由url写入Zuul的.properties配置文件中。如下：

```properties
zuul.routes.ai-alert-service.path=/zb-api/ai-alert-service/** 
# If Eureka in not working, the subsequent code should be added so that Zuul can find url by app-name, or zuul can find url from Eureka
zuul.routes.ai-alert-service.url=http://127.0.0.1:6002
```

其中ai-alert-service是一个组件的app-name。通过.path属性，建立与app-name的映射，并从.url属性中获取url组件运行的url地址。app-name一般是在每个单独模组的application.properties文件或者bootstrap.properties文件中设置的，如下：

```properties
spring.application.name=ai-alert-service
```

### 2.4 Zuul实现SwaggerUI

使用与1.2和1.3中完全相同的方法，建立config包，并添加SwaggerConfig和WebMvcConfig两个配置类。然后再新建MultiDocConfig类，用于配置Swagger资源的路由，代码如下：

```java
import org.springframework.context.annotation.Primary;
import org.springframework.stereotype.Component;
import springfox.documentation.swagger.web.SwaggerResource;
import springfox.documentation.swagger.web.SwaggerResourcesProvider;

import java.util.ArrayList;
import java.util.List;

/**
 * @program: smartsite-master
 * @description:
 * @author: Barrett
 * @create: 2020-07-02 18:02
 **/
@Component
@Primary
public class MultiDocConfig implements SwaggerResourcesProvider {

    @Override
    public List<SwaggerResource> get() {

        List resources = new ArrayList<>();

        /**
         * AI-Alert-Service ---> 这个就是个模块的名字，可以随便起
         * /zb-api/face-detect-service/v2/api-docs ---> /zb-api/face-detect-service就是application.properties配置的路由路径，
         * 后面的/v2/api-docs固定写法
         */
        resources.add(swaggerResource("AI-Alert-Service", "/zb-api/ai-alert-service/v2/api-docs", "2.0"));
        resources.add(swaggerResource("Face-Detect-Service", "/zb-api/face-detect-service/v2/api-docs", "2.0"));

        return resources;
    }

    private Object swaggerResource(String name, String location, String version) {

        SwaggerResource swaggerResource = new SwaggerResource();
        swaggerResource.setName(name);
        swaggerResource.setLocation(location);
        swaggerResource.setSwaggerVersion(version);
        return swaggerResource;
    }
}

```



### 2.5 运行与测试

完成以上配置之后，分别启动Eureka注册中心，Zuul网关和每个单独的组件，使用**http://${网关运行的IP}:${网关运行的端口}/swagger-ui.html**来访问SwaggerUI文档，如下图所示：

<img src="C:\Users\spg_b\AppData\Roaming\Typora\typora-user-images\image-20200702190240633.png" alt="image-20200702190240633" style="zoom:50%;" />



通过右上角的下拉菜单，可以切换不同组件的API文档。











